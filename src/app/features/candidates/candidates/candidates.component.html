<app-sidebar activePage="candidates"></app-sidebar>
<div class="candidates-page">
    <main class="main-content">
        <!-- Loading State -->
        <div class="loading-state" *ngIf="loading">
            <div class="spinner"></div>
            <p>Loading candidates...</p>
        </div>

        <ng-container *ngIf="!loading">
            <!-- Stats Row -->
<!--            <div class="stats-row">-->
<!--                <div class="stat-card">-->
<!--                    <div class="stat-icon">üë•</div>-->
<!--                    <div class="stat-info">-->
<!--                        <span class="stat-value">{{ stats.totalCandidates }}</span>-->
<!--                        <span class="stat-label">Total Candidates</span>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="stat-card">-->
<!--                    <div class="stat-icon">üìÑ</div>-->
<!--                    <div class="stat-info">-->
<!--                        <span class="stat-value">{{ stats.totalResumes }}</span>-->
<!--                        <span class="stat-label">Total Resumes</span>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="stat-card">-->
<!--                    <div class="stat-icon">üõ†Ô∏è</div>-->
<!--                    <div class="stat-info">-->
<!--                        <span class="stat-value">{{ stats.totalSkills }}</span>-->
<!--                        <span class="stat-label">Unique Skills</span>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

            <!-- Candidates Section -->
            <div class="candidates-section">
                <!-- Empty State -->
                <div class="empty-state" *ngIf="candidates.length === 0">
                    <div class="empty-icon">üë•</div>
                    <p>No candidates yet. Upload resumes to see candidates here!</p>
                    <label class="btn-primary upload-label" [class.uploading]="uploading">
                        <span *ngIf="!uploading"><i class="pi pi-upload"></i> Upload Resume</span>
                        <span *ngIf="uploading">Uploading & Extracting...</span>
                        <input type="file" accept=".pdf,.docx" (change)="onResumeFileSelected($event)" hidden [disabled]="uploading" />
                    </label>
                </div>

                <!-- PrimeNG Data Table -->
                <p-table
                    #dt
                    *ngIf="candidates.length > 0"
                    [value]="candidates"
                    [paginator]="true"
                    [rows]="10"
                    [rowsPerPageOptions]="[5, 10, 25, 50]"
                    [showCurrentPageReport]="true"
                    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} candidates"
                    [globalFilterFields]="['name', 'email', 'current_title', 'current_company', 'location']"
                    dataKey="id"
                    [rowHover]="true"
                    [expandedRowKeys]="expandedRows"
                    styleClass="p-datatable-sm candidates-table"
                    [tableStyle]="{ 'table-layout': 'fixed', 'width': '100%' }"
                >
                    <!-- Table Caption -->
                    <ng-template pTemplate="caption">
                        <div class="table-header">
                            <div class="table-header-left">
                                <h2>Candidates</h2>
                                <span class="candidate-count">{{ candidates.length }} total</span>
                            </div>
                            <div class="table-header-right">
                                <div class="search-box">
                                    <i class="pi pi-search"></i>
                                    <input
                                        type="text"
                                        [(ngModel)]="searchTerm"
                                        (input)="onGlobalFilter($event)"
                                        placeholder="Search candidates..."
                                    />
                                </div>
                                <label class="upload-resume-btn" [class.uploading]="uploading">
                                    <i class="pi pi-upload" *ngIf="!uploading"></i>
                                    <span *ngIf="!uploading">Upload Resume</span>
                                    <span *ngIf="uploading">Uploading...</span>
                                    <input type="file" accept=".pdf,.docx" (change)="onResumeFileSelected($event)" hidden [disabled]="uploading" />
                                </label>
                                <button class="clear-filters-btn" (click)="clearFilters()" *ngIf="searchTerm || selectedCompanies.length || selectedLocations.length">
                                    <i class="pi pi-filter-slash"></i>
                                    Clear
                                </button>
                            </div>
                        </div>
                    </ng-template>

                    <!-- Table Header -->
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 48px"></th>
                            <th (click)="onSort($event, 'name')" class="sortable-col" style="width: 220px">
                                <div class="header-cell">
                                    <span>Name</span>
                                    <i class="pi sort-icon" [ngClass]="getSortIcon('name')"></i>
                                </div>
                            </th>
                            <th (click)="onSort($event, 'current_company')" class="sortable-col" style="min-width: 200px">
                                <div class="header-cell">
                                    <span>Title / Company</span>
                                    <i class="pi sort-icon" [ngClass]="getSortIcon('current_company')"></i>
                                    <div class="filter-wrapper" (click)="$event.stopPropagation()">
                                        <i class="pi pi-filter" [class.active]="selectedCompanies.length > 0"></i>
                                        <span class="filter-count" *ngIf="selectedCompanies.length > 0">{{ selectedCompanies.length }}</span>
                                        <p-multiSelect
                                            [options]="companyOptions"
                                            [(ngModel)]="selectedCompanies"
                                            (onChange)="onCompanyFilterChange()"
                                            [showHeader]="false"
                                            [showToggleAll]="false"
                                            placeholder="Filter"
                                            styleClass="filter-multiselect"
                                            appendTo="body"
                                        ></p-multiSelect>
                                    </div>
                                </div>
                            </th>
                            <th style="min-width: 180px">Contact</th>
                            <th (click)="onSort($event, 'location')" class="sortable-col" style="width: 150px; max-width: 150px">
                                <div class="header-cell">
                                    <span>Location</span>
                                    <i class="pi sort-icon" [ngClass]="getSortIcon('location')"></i>
                                    <div class="filter-wrapper" (click)="$event.stopPropagation()">
                                        <i class="pi pi-filter" [class.active]="selectedLocations.length > 0"></i>
                                        <span class="filter-count" *ngIf="selectedLocations.length > 0">{{ selectedLocations.length }}</span>
                                        <p-multiSelect
                                            [options]="locationOptions"
                                            [(ngModel)]="selectedLocations"
                                            (onChange)="onLocationFilterChange()"
                                            [showHeader]="false"
                                            [showToggleAll]="false"
                                            placeholder="Filter"
                                            styleClass="filter-multiselect"
                                            appendTo="body"
                                        ></p-multiSelect>
                                    </div>
                                </div>
                            </th>
                            <th (click)="onSort($event, 'years_of_experience')" class="sortable-col" style="width: 120px">
                                <div class="header-cell">
                                    <span>Experience</span>
                                    <i class="pi sort-icon" [ngClass]="getSortIcon('years_of_experience')"></i>
                                </div>
                            </th>
                            <th style="width: 100px; text-align: center">Actions</th>
                        </tr>
                    </ng-template>

                    <!-- Table Body -->
                    <ng-template pTemplate="body" let-candidate let-expanded="expanded">
                        <tr class="candidate-row">
                            <!-- Expand Toggle -->
                            <td class="expand-cell">
                                <button type="button" [pRowToggler]="candidate" class="expand-btn">
                                    <i class="pi" [ngClass]="expanded ? 'pi-chevron-down' : 'pi-chevron-right'"></i>
                                </button>
                            </td>

                            <!-- Name -->
                            <td class="name-cell">
                                <div class="candidate-name">{{ candidate.name }}</div>
                            </td>

                            <!-- Title / Company -->
                            <td class="title-cell">
                                <div class="title-info">
                                    <span class="job-title">{{ candidate.current_title || '‚Äî' }}</span>
                                    <span class="company" *ngIf="candidate.current_company">{{ candidate.current_company }}</span>
                                </div>
                            </td>

                            <!-- Contact -->
                            <td class="contact-cell">
                                <div class="contact-info">
                                    <span class="email" *ngIf="candidate.email">{{ candidate.email }}</span>
                                    <span class="phone" *ngIf="candidate.phone">{{ candidate.phone }}</span>
                                    <span class="no-data" *ngIf="!candidate.email && !candidate.phone">‚Äî</span>
                                </div>
                            </td>

                            <!-- Location -->
                            <td class="location-cell">
                                <span class="location">{{ candidate.location || '‚Äî' }}</span>
                            </td>

                            <!-- Experience -->
                            <td class="experience-cell">
                                <div class="exp-info">
                                    <span class="exp-years" *ngIf="candidate.years_of_experience">{{ candidate.years_of_experience }} yrs</span>
                                </div>
                            </td>
                            <!-- Actions -->
                            <td class="actions-cell">
                                <button class="action-btn" (click)="viewCandidate(candidate)" title="View details">
                                    <i class="pi pi-eye"></i>
                                </button>
                            </td>
                        </tr>
                    </ng-template>

                    <!-- Row Expansion -->
                    <ng-template pTemplate="rowexpansion" let-candidate>
                        <tr class="expand-row">
                            <td colspan="7">
                                <div class="expand-content">
                                    <div class="expand-grid">
                                        <!-- All Skills -->
                                        <div class="expand-section">
                                            <h4><i class="pi pi-tags"></i> Top Skills</h4>
                                            <div class="skills-full">
                                                <span class="skill-tag-lg" *ngFor="let skill of candidate.skills?.slice(0, 6)">
                                                    {{ skill.name }}
                                                    <span class="proficiency" *ngIf="skill.proficiency">({{ skill.proficiency }})</span>
                                                </span>
                                                <span class="skills-more" *ngIf="candidate.skills?.length > 6">+{{ candidate.skills.length - 6 }} more</span>
                                            </div>
                                            <div class="no-skills" *ngIf="!candidate.skills?.length">No skills extracted</div>
                                        </div>

                                        <!-- Preferences & Experience -->
                                        <div class="expand-section">
                                            <h4><i class="pi pi-briefcase"></i> Preferences & Experience</h4>
                                            <div class="pref-details">
                                                <div class="detail-item" *ngIf="candidate.experience_level">
                                                    <span class="detail-label">Level</span>
                                                    <span class="detail-value">{{ candidate.experience_level }}</span>
                                                </div>
                                                <div class="detail-item" *ngIf="candidate.preferences?.preferred_work_type?.length">
                                                    <span class="detail-label">Work Type</span>
                                                    <span class="detail-value">{{ candidate.preferences!.preferred_work_type.join(', ') | titlecase }}</span>
                                                </div>
                                                <div class="detail-item" *ngIf="candidate.preferences?.preferred_locations?.length">
                                                    <span class="detail-label">Preferred Locations</span>
                                                    <span class="detail-value">{{ candidate.preferences!.preferred_locations.join(', ') }}</span>
                                                </div>
                                                <div class="detail-item" *ngIf="candidate.preferences?.salary_expectation_min || candidate.preferences?.salary_expectation_max">
                                                    <span class="detail-label">Salary</span>
                                                    <span class="detail-value">
                                                        {{ candidate.preferences!.salary_currency || 'USD' }}
                                                        <span *ngIf="candidate.preferences!.salary_expectation_min">{{ candidate.preferences!.salary_expectation_min | number }}</span>
                                                        <span *ngIf="candidate.preferences!.salary_expectation_min && candidate.preferences!.salary_expectation_max"> - </span>
                                                        <span *ngIf="candidate.preferences!.salary_expectation_max">{{ candidate.preferences!.salary_expectation_max | number }}</span>
                                                    </span>
                                                </div>
                                                <div class="detail-item" *ngIf="candidate.preferences?.preferred_job_titles?.length">
                                                    <span class="detail-label">Target Roles</span>
                                                    <span class="detail-value">{{ candidate.preferences!.preferred_job_titles.join(', ') }}</span>
                                                </div>
                                                <div class="detail-item" *ngIf="candidate.preferences?.willing_to_relocate">
                                                    <span class="detail-label">Relocate</span>
                                                    <span class="detail-value">Yes</span>
                                                </div>
                                                <div class="no-skills" *ngIf="!candidate.experience_level && !candidate.preferences">No preferences set</div>
                                            </div>
                                        </div>

                                        <!-- Resumes -->
                                        <div class="expand-section">
                                            <h4><i class="pi pi-file"></i> Resumes ({{ candidate.resume_count }})</h4>
                                            <div class="resume-list">
                                                <div class="resume-item" *ngFor="let resume of candidate.resumes" [class.primary]="resume.is_primary">
                                                    <div class="resume-info">
                                                        <span class="resume-display-name">{{ getResumeDisplayName(resume) }}</span>
                                                        <span class="resume-name">{{ resume.file_name }}</span>
                                                        <div class="resume-meta">
                                                            <span class="extraction-status" [ngClass]="getStatusClass(resume.extraction_status)">
                                                                <span class="status-dot"></span>
                                                                {{ getStatusText(resume.extraction_status) }}
                                                            </span>
                                                            <span class="primary-badge-sm" *ngIf="resume.is_primary"><i class="pi pi-star-fill"></i> Primary</span>
                                                            <span class="resume-date">{{ formatDate(resume.created_at) }}</span>
                                                        </div>
                                                    </div>
                                                    <div class="resume-actions">
                                                        <button class="btn-sm" (click)="openResumeFile(resume)" title="Open">
                                                            <i class="pi pi-external-link"></i>
                                                        </button>
                                                        <button class="btn-sm" (click)="downloadResume(resume)" title="Download">
                                                            <i class="pi pi-download"></i>
                                                        </button>
                                                        <button class="btn-sm resume-action-btn analyze" (click)="goToAnalyzer(resume)" title="Analyze">
                                                            <i class="pi pi-chart-bar"></i>
                                                        </button>
                                                        <button class="btn-sm resume-action-btn primary" (click)="setResumePrimary(resume); $event.stopPropagation()" title="Set as Primary" *ngIf="!resume.is_primary">
                                                            <i class="pi pi-star"></i>
                                                        </button>
                                                        <button class="btn-sm resume-action-btn delete" (click)="confirmDeleteResume(resume); $event.stopPropagation()" title="Delete">
                                                            <i class="pi pi-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </ng-template>

                    <!-- Empty Message -->
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="empty-table-message">
                                <i class="pi pi-search"></i>
                                <p>No candidates match your filters.</p>
                                <button class="btn-text" (click)="clearFilters()">Clear Filters</button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </ng-container>
    </main>

    <!-- Candidate Detail Modal -->
    <div class="modal-overlay" *ngIf="showCandidateModal" (click)="closeCandidateModal()">
        <div class="modal candidate-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>üë§ {{ selectedCandidate?.name }}</h3>
                <button class="close-btn" (click)="closeCandidateModal()">‚úï</button>
            </div>

            <div class="modal-body" *ngIf="selectedCandidate">
                <!-- Candidate Header -->
                <div class="candidate-header-section">
                    <div class="candidate-main-info">
                        <h2>{{ selectedCandidate.name }}</h2>
                        <p class="title-company" *ngIf="selectedCandidate.current_title">
                            {{ selectedCandidate.current_title }}
                            <span *ngIf="selectedCandidate.current_company">at {{ selectedCandidate.current_company }}</span>
                        </p>
                        <div class="candidate-meta">
                            <span *ngIf="selectedCandidate.location">üìç {{ selectedCandidate.location }}</span>
                            <span *ngIf="selectedCandidate.years_of_experience">üìä {{ selectedCandidate.years_of_experience }} years experience</span>
                            <span *ngIf="selectedCandidate.experience_level" class="level-badge">{{ selectedCandidate.experience_level }}</span>
                        </div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="modal-tabs">
                    <button class="tab-btn" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">
                        Overview
                    </button>
                    <button class="tab-btn" [class.active]="activeTab === 'preferences'" (click)="setActiveTab('preferences')">
                        Preferences
                    </button>
                    <button class="tab-btn" [class.active]="activeTab === 'documents'" (click)="setActiveTab('documents')">
                        Documents
                        <span class="tab-badge" *ngIf="candidateDocuments.length">{{ candidateDocuments.length }}</span>
                    </button>
                </div>

                <!-- Tab Content: Overview -->
                <div class="tab-content" *ngIf="activeTab === 'overview'">
                    <div class="candidate-details-grid">
                        <!-- Left Column -->
                        <div class="details-left">
                            <div class="detail-section">
                                <h4>Contact Information</h4>
                                <div class="contact-grid">
                                    <div class="contact-item" *ngIf="selectedCandidate.email">
                                        <span class="label">Email</span>
                                        <a [href]="'mailto:' + selectedCandidate.email">{{ selectedCandidate.email }}</a>
                                    </div>
                                    <div class="contact-item" *ngIf="selectedCandidate.phone">
                                        <span class="label">Phone</span>
                                        <a [href]="'tel:' + selectedCandidate.phone">{{ selectedCandidate.phone }}</a>
                                    </div>
                                    <div class="contact-item" *ngIf="selectedCandidate.linkedin">
                                        <span class="label">LinkedIn</span>
                                        <a [href]="selectedCandidate.linkedin" target="_blank">View Profile</a>
                                    </div>
                                </div>
                            </div>
                            <div class="detail-section" *ngIf="selectedCandidate.skills?.length">
                                <h4>Skills ({{ selectedCandidate.skills.length }})</h4>
                                <div class="skills-grid">
                                    <div class="skill-item" *ngFor="let skill of selectedCandidate.skills">
                                        <span class="skill-name">{{ skill.name }}</span>
                                        <span class="skill-proficiency" *ngIf="skill.proficiency">{{ skill.proficiency }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Right Column - Resumes -->
                        <div class="details-right">
                            <div class="detail-section">
                                <h4>Resumes ({{ selectedCandidate.resume_count }})</h4>
                                <div class="resume-selector">
                                    <div class="resume-card" *ngFor="let resume of selectedCandidate.resumes" [class.selected]="selectedResume?.id === resume.id" [class.primary]="resume.is_primary" (click)="selectResume(resume)">
                                        <div class="resume-card-header">
                                            <span class="resume-icon">üìÑ</span>
                                            <div class="resume-card-info">
                                                <span class="resume-card-display-name">{{ getResumeDisplayName(resume) }}</span>
                                                <span class="resume-card-name">{{ resume.file_name }}</span>
                                                <span class="resume-card-date">Uploaded {{ formatDate(resume.created_at) }}</span>
                                            </div>
                                            <div class="resume-card-badges">
                                                <span class="extraction-status" [ngClass]="getStatusClass(resume.extraction_status)">
                                                    <span class="status-dot"></span>
                                                    {{ getStatusText(resume.extraction_status) }}
                                                </span>
                                                <span class="primary-badge-sm" *ngIf="resume.is_primary"><i class="pi pi-star-fill"></i> Primary</span>
                                            </div>
                                        </div>
                                        <div class="resume-card-actions">
                                            <button class="btn-action" (click)="openResumeFile(resume); $event.stopPropagation()"><i class="pi pi-external-link"></i> Open</button>
                                            <button class="btn-action" (click)="downloadResume(resume); $event.stopPropagation()"><i class="pi pi-download"></i> Download</button>
                                            <button class="btn-action analyze" (click)="goToAnalyzer(resume); $event.stopPropagation()"><i class="pi pi-chart-bar"></i> Analyze</button>
                                            <button class="btn-action set-primary" (click)="setResumePrimary(resume); $event.stopPropagation()" *ngIf="!resume.is_primary"><i class="pi pi-star"></i> Primary</button>
                                            <button class="btn-action delete" (click)="confirmDeleteResume(resume); $event.stopPropagation()"><i class="pi pi-trash"></i> Delete</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="detail-section" *ngIf="selectedResume">
                                <h4>Resume Details</h4>
                                <div class="resume-details">
                                    <div class="resume-detail-row" *ngIf="selectedResume.professional_summary">
                                        <span class="label">Summary</span>
                                        <p>{{ selectedResume.professional_summary }}</p>
                                    </div>
                                    <div class="resume-detail-row" *ngIf="selectedResume.education?.length">
                                        <span class="label">Education</span>
                                        <div class="education-list">
                                            <div class="edu-item" *ngFor="let edu of selectedResume.education">
                                                <span class="degree">{{ edu.degree }}</span>
                                                <span class="institution">{{ edu.institution }} <span *ngIf="edu.year">¬∑ {{ edu.year }}</span></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="resume-detail-row" *ngIf="selectedResume.work_history?.length">
                                        <span class="label">Work History</span>
                                        <div class="work-list">
                                            <div class="work-item" *ngFor="let work of selectedResume.work_history.slice(0, 3)">
                                                <span class="work-title">{{ work.title }}</span>
                                                <span class="work-company">{{ work.company }}</span>
                                                <span class="work-dates">{{ work.start }} - {{ work.end || 'Present' }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Preferences -->
                <div class="tab-content" *ngIf="activeTab === 'preferences'">
                    <div class="preferences-section">
                        <div class="preferences-header">
                            <h4>Job Preferences</h4>
                            <div class="preferences-actions" *ngIf="!editingPreferences">
                                <button class="btn-edit" (click)="startEditingPreferences()">Edit Preferences</button>
                            </div>
                            <div class="preferences-actions" *ngIf="editingPreferences">
                                <button class="btn-cancel" (click)="cancelEditingPreferences()">Cancel</button>
                                <button class="btn-save" (click)="savePreferences()" [disabled]="savingPreferences">
                                    {{ savingPreferences ? 'Saving...' : 'Save' }}
                                </button>
                            </div>
                        </div>

                        <div class="preferences-grid">
                            <!-- Job Titles -->
                            <div class="pref-section">
                                <label class="pref-label">Preferred Job Titles</label>
                                <div class="tag-input-container" *ngIf="editingPreferences">
                                    <input type="text" placeholder="Add job title and press Enter" (keydown.enter)="addPreferredJobTitle($event)" class="pref-input" />
                                </div>
                                <div class="tags-list">
                                    <span class="pref-tag" *ngFor="let title of editedPreferences.preferred_job_titles">
                                        {{ title }}
                                        <button class="remove-tag" *ngIf="editingPreferences" (click)="removePreferredJobTitle(title)">√ó</button>
                                    </span>
                                    <span class="no-data" *ngIf="!editedPreferences.preferred_job_titles?.length">Not specified</span>
                                </div>
                            </div>

                            <!-- Locations -->
                            <div class="pref-section">
                                <label class="pref-label">Preferred Locations</label>
                                <div class="tag-input-container" *ngIf="editingPreferences">
                                    <input type="text" placeholder="Add location and press Enter" (keydown.enter)="addPreferredLocation($event)" class="pref-input" />
                                </div>
                                <div class="tags-list">
                                    <span class="pref-tag" *ngFor="let loc of editedPreferences.preferred_locations">
                                        {{ loc }}
                                        <button class="remove-tag" *ngIf="editingPreferences" (click)="removePreferredLocation(loc)">√ó</button>
                                    </span>
                                    <span class="no-data" *ngIf="!editedPreferences.preferred_locations?.length">Not specified</span>
                                </div>
                            </div>

                            <!-- Work Type -->
                            <div class="pref-section">
                                <label class="pref-label">Work Type</label>
                                <div class="checkbox-group" [class.disabled]="!editingPreferences">
                                    <label class="checkbox-item" *ngFor="let type of workTypeOptions">
                                        <input type="checkbox" [checked]="isWorkTypeSelected(type)" (change)="toggleWorkType(type)" [disabled]="!editingPreferences" />
                                        <span class="checkbox-label">{{ type | titlecase }}</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Company Size -->
                            <div class="pref-section">
                                <label class="pref-label">Company Size</label>
                                <div class="checkbox-group" [class.disabled]="!editingPreferences">
                                    <label class="checkbox-item" *ngFor="let size of companySizeOptions">
                                        <input type="checkbox" [checked]="isCompanySizeSelected(size)" (change)="toggleCompanySize(size)" [disabled]="!editingPreferences" />
                                        <span class="checkbox-label">{{ size | titlecase }}</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Industries -->
                            <div class="pref-section">
                                <label class="pref-label">Preferred Industries</label>
                                <div class="tag-input-container" *ngIf="editingPreferences">
                                    <input type="text" placeholder="Add industry and press Enter" (keydown.enter)="addPreferredIndustry($event)" class="pref-input" />
                                </div>
                                <div class="tags-list">
                                    <span class="pref-tag" *ngFor="let ind of editedPreferences.preferred_industries">
                                        {{ ind }}
                                        <button class="remove-tag" *ngIf="editingPreferences" (click)="removePreferredIndustry(ind)">√ó</button>
                                    </span>
                                    <span class="no-data" *ngIf="!editedPreferences.preferred_industries?.length">Not specified</span>
                                </div>
                            </div>

                            <!-- Salary -->
                            <div class="pref-section salary-section">
                                <label class="pref-label">Salary Expectation</label>
                                <div class="salary-inputs" *ngIf="editingPreferences">
                                    <input type="number" [(ngModel)]="editedPreferences.salary_expectation_min" placeholder="Min" class="pref-input salary-input" />
                                    <span class="salary-separator">to</span>
                                    <input type="number" [(ngModel)]="editedPreferences.salary_expectation_max" placeholder="Max" class="pref-input salary-input" />
                                    <select [(ngModel)]="editedPreferences.salary_currency" class="pref-select">
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                        <option value="GBP">GBP</option>
                                        <option value="AUD">AUD</option>
                                    </select>
                                </div>
                                <div class="salary-display" *ngIf="!editingPreferences">
                                    <span *ngIf="editedPreferences.salary_expectation_min || editedPreferences.salary_expectation_max">
                                        {{ editedPreferences.salary_currency || 'USD' }} {{ editedPreferences.salary_expectation_min | number }} - {{ editedPreferences.salary_expectation_max | number }}
                                    </span>
                                    <span class="no-data" *ngIf="!editedPreferences.salary_expectation_min && !editedPreferences.salary_expectation_max">Not specified</span>
                                </div>
                            </div>

                            <!-- Availability -->
                            <div class="pref-section">
                                <label class="pref-label">Available Start Date</label>
                                <input *ngIf="editingPreferences" type="date" [(ngModel)]="editedPreferences.available_start_date" class="pref-input" />
                                <span *ngIf="!editingPreferences">{{ editedPreferences.available_start_date ? formatDate(editedPreferences.available_start_date!) : 'Not specified' }}</span>
                            </div>

                            <!-- Notice Period -->
                            <div class="pref-section">
                                <label class="pref-label">Notice Period</label>
                                <div class="notice-input" *ngIf="editingPreferences">
                                    <input type="number" [(ngModel)]="editedPreferences.notice_period_days" placeholder="Days" class="pref-input" style="width: 100px" />
                                    <span>days</span>
                                </div>
                                <span *ngIf="!editingPreferences">{{ editedPreferences.notice_period_days ? editedPreferences.notice_period_days + ' days' : 'Not specified' }}</span>
                            </div>

                            <!-- Work Authorization -->
                            <div class="pref-section">
                                <label class="pref-label">Work Authorization</label>
                                <input *ngIf="editingPreferences" type="text" [(ngModel)]="editedPreferences.work_authorization" placeholder="e.g., US Citizen, H1B" class="pref-input" />
                                <span *ngIf="!editingPreferences">{{ editedPreferences.work_authorization || 'Not specified' }}</span>
                            </div>

                            <!-- Boolean Options -->
                            <div class="pref-section boolean-options">
                                <div class="bool-row">
                                    <label class="bool-label">
                                        <input type="checkbox" [(ngModel)]="editedPreferences.willing_to_relocate" [disabled]="!editingPreferences" />
                                        Willing to Relocate
                                    </label>
                                </div>
                                <div class="bool-row">
                                    <label class="bool-label">
                                        <input type="checkbox" [(ngModel)]="editedPreferences.has_drivers_license" [disabled]="!editingPreferences" />
                                        Has Driver's License
                                    </label>
                                </div>
                                <div class="bool-row">
                                    <label class="bool-label">
                                        <input type="checkbox" [(ngModel)]="editedPreferences.willing_to_travel" [disabled]="!editingPreferences" />
                                        Willing to Travel
                                    </label>
                                    <input *ngIf="editedPreferences.willing_to_travel && editingPreferences" type="number" [(ngModel)]="editedPreferences.travel_percentage" placeholder="%" class="travel-percent" min="0" max="100" />
                                    <span *ngIf="editedPreferences.willing_to_travel && !editingPreferences && editedPreferences.travel_percentage">({{ editedPreferences.travel_percentage }}%)</span>
                                </div>
                            </div>

                            <!-- Notes -->
                            <div class="pref-section full-width">
                                <label class="pref-label">Notes</label>
                                <textarea *ngIf="editingPreferences" [(ngModel)]="editedPreferences.notes" placeholder="Additional notes..." class="pref-textarea" rows="3"></textarea>
                                <p class="notes-display" *ngIf="!editingPreferences">{{ editedPreferences.notes || 'No notes' }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Documents -->
                <div class="tab-content" *ngIf="activeTab === 'documents'">
                    <div class="documents-section">
                        <!-- Upload Form -->
                        <div class="upload-document-form">
                            <h4>Upload Document</h4>
                            <div class="upload-form-grid">
                                <div class="form-row">
                                    <label>Document Type</label>
                                    <select [(ngModel)]="newDocumentType" class="doc-select">
                                        <option *ngFor="let dt of documentTypes" [value]="dt.value">{{ dt.label }}</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>Document Name</label>
                                    <input type="text" [(ngModel)]="newDocumentName" placeholder="e.g., Driver's License" class="doc-input" />
                                </div>
                                <div class="form-row">
                                    <label>Expiry Date</label>
                                    <input type="date" [(ngModel)]="newDocumentExpiry" class="doc-input" />
                                </div>
                                <div class="form-row full">
                                    <label>Notes</label>
                                    <input type="text" [(ngModel)]="newDocumentNotes" placeholder="Additional notes..." class="doc-input" />
                                </div>
                            </div>
                            <label class="upload-btn" [class.uploading]="uploadingDocument">
                                <span *ngIf="!uploadingDocument">üìé Select File to Upload</span>
                                <span *ngIf="uploadingDocument">Uploading...</span>
                                <input type="file" (change)="onDocumentFileSelected($event)" hidden [disabled]="uploadingDocument" />
                            </label>
                            <p class="upload-hint">Supported: PDF, JPG, PNG, DOC. Max 10MB</p>
                        </div>

                        <!-- Documents List -->
                        <div class="documents-list">
                            <h4>Uploaded Documents ({{ candidateDocuments.length }})</h4>
                            <div class="loading-docs" *ngIf="loadingDocuments">Loading documents...</div>
                            <div class="no-documents" *ngIf="!loadingDocuments && candidateDocuments.length === 0">
                                <p>No documents uploaded yet.</p>
                            </div>
                            <div class="document-cards" *ngIf="!loadingDocuments && candidateDocuments.length > 0">
                                <div class="document-card" *ngFor="let doc of candidateDocuments" [class.expired]="isDocumentExpired(doc)" [class.expiring-soon]="isDocumentExpiringSoon(doc)">
                                    <div class="doc-icon">{{ getDocumentIcon(doc.document_type) }}</div>
                                    <div class="doc-info">
                                        <div class="doc-name">{{ doc.document_name }}</div>
                                        <div class="doc-meta">
                                            <span class="doc-type">{{ getDocumentTypeLabel(doc.document_type) }}</span>
                                            <span class="doc-size" *ngIf="doc.file_size">¬∑ {{ formatFileSize(doc.file_size) }}</span>
                                        </div>
                                        <div class="doc-expiry" *ngIf="doc.expiry_date">
                                            <span class="expiry-label" [class.expired]="isDocumentExpired(doc)" [class.warning]="isDocumentExpiringSoon(doc)">
                                                {{ isDocumentExpired(doc) ? 'Expired' : 'Expires' }}: {{ formatDate(doc.expiry_date) }}
                                            </span>
                                        </div>
                                        <div class="doc-notes" *ngIf="doc.notes">{{ doc.notes }}</div>
                                    </div>
                                    <div class="doc-actions">
                                        <button class="doc-action-btn" (click)="openDocument(doc)" title="View">üîó</button>
                                        <button class="doc-action-btn delete" (click)="deleteDocument(doc)" title="Delete">üóëÔ∏è</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" (click)="closeCandidateModal()">Close</button>
                <button class="btn-primary" *ngIf="selectedResume && activeTab === 'overview'" (click)="downloadResume(selectedResume)">
                    ‚¨áÔ∏è Download Resume
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Resume Confirmation Modal -->
    <div class="modal-overlay" *ngIf="showDeleteResumeConfirm" (click)="cancelDeleteResume()">
        <div class="modal delete-resume-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3><i class="pi pi-trash" style="color: #dc2626;"></i> Delete Resume</h3>
                <button class="close-btn" (click)="cancelDeleteResume()">‚úï</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this resume?</p>
                <div class="delete-resume-info" *ngIf="resumeToDelete">
                    <span class="delete-resume-name">{{ getResumeDisplayName(resumeToDelete) }}</span>
                    <span class="delete-file-name">{{ resumeToDelete.file_name }}</span>
                </div>
                <p class="warning-text">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" (click)="cancelDeleteResume()">Cancel</button>
                <button class="btn-danger" (click)="executeDeleteResume()">Delete</button>
            </div>
        </div>
    </div>
</div>
